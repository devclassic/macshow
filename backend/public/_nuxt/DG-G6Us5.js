import{f as ce}from"./BzzUKFE_.js";import{H,J as B,z as y,D as te,G as K,P as k,k as T,q as j,a0 as ae,Z as ie,C as fe,o as de,aA as le,T as I,a1 as D}from"./C_51ZNOb.js";import{l as x,_ as ne,I as Ee,b as pe,d as ve,w as me}from"./DtnbboDV.js";import{g as oe,E as se}from"./CxPtGPO6.js";const P="focus-trap.focus-after-trapped",U="focus-trap.focus-after-released",Te="focus-trap.focusout-prevented",J={cancelable:!0,bubbles:!1},_e={cancelable:!0,bubbles:!1},W="focusAfterTrapped",X="focusAfterReleased",Se=Symbol("elFocusTrap"),M=y(),A=y(0),Y=y(0);let _=0;const re=e=>{const s=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const u=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||u?NodeFilter.FILTER_SKIP:n.tabIndex>=0||n===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)s.push(o.currentNode);return s},z=(e,s)=>{for(const o of e)if(!Le(o,s))return o},Le=(e,s)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(s&&e===s)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},be=e=>{const s=re(e),o=z(s,e),n=z(s.reverse(),e);return[o,n]},ye=e=>e instanceof HTMLInputElement&&"select"in e,l=(e,s)=>{if(e){const o=document.activeElement;ce(e,{preventScroll:!0}),Y.value=window.performance.now(),e!==o&&ye(e)&&s&&e.select()}};function Z(e,s){const o=[...e],n=e.indexOf(s);return n!==-1&&o.splice(n,1),o}const Ae=()=>{let e=[];return{push:n=>{const u=e[0];u&&n!==u&&u.pause(),e=Z(e,n),e.unshift(n)},remove:n=>{var u,f;e=Z(e,n),(f=(u=e[0])==null?void 0:u.resume)==null||f.call(u)}}},Ce=(e,s=!1)=>{const o=document.activeElement;for(const n of e)if(l(n,s),document.activeElement!==o)return},h=Ae(),Ne=()=>A.value>Y.value,S=()=>{M.value="pointer",A.value=window.performance.now()},Q=()=>{M.value="keyboard",A.value=window.performance.now()},Re=()=>(H(()=>{_===0&&(document.addEventListener("mousedown",S),document.addEventListener("touchstart",S),document.addEventListener("keydown",Q)),_++}),B(()=>{_--,_<=0&&(document.removeEventListener("mousedown",S),document.removeEventListener("touchstart",S),document.removeEventListener("keydown",Q))}),{focusReason:M,lastUserFocusTimestamp:A,lastAutomatedFocusTimestamp:Y}),L=e=>new CustomEvent(Te,{..._e,detail:e});let p=[];const ee=e=>{oe(e)===se.esc&&p.forEach(o=>o(e))},Oe=e=>{H(()=>{p.length===0&&document.addEventListener("keydown",ee),x&&p.push(e)}),B(()=>{p=p.filter(s=>s!==e),p.length===0&&x&&document.removeEventListener("keydown",ee)})},Fe=te({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[W,X,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:s}){const o=y();let n,u;const{focusReason:f}=Re();Oe(t=>{e.trapped&&!E.paused&&s("release-requested",t)});const E={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},v=t=>{if(!e.loop&&!e.trapped||E.paused)return;const{altKey:r,ctrlKey:c,metaKey:a,currentTarget:i,shiftKey:R}=t,{loop:g}=e,ue=oe(t)===se.tab&&!r&&!c&&!a,m=document.activeElement;if(ue&&m){const O=i,[F,w]=be(O);if(F&&w){if(!R&&m===w){const d=L({focusReason:f.value});s("focusout-prevented",d),d.defaultPrevented||(t.preventDefault(),g&&l(F,!0))}else if(R&&[F,O].includes(m)){const d=L({focusReason:f.value});s("focusout-prevented",d),d.defaultPrevented||(t.preventDefault(),g&&l(w,!0))}}else if(m===O){const d=L({focusReason:f.value});s("focusout-prevented",d),d.defaultPrevented||t.preventDefault()}}};ie(Se,{focusTrapRef:o,onKeydown:v}),k(()=>e.focusTrapEl,t=>{t&&(o.value=t)},{immediate:!0}),k([o],([t],[r])=>{t&&(t.addEventListener("keydown",v),t.addEventListener("focusin",C),t.addEventListener("focusout",N)),r&&(r.removeEventListener("keydown",v),r.removeEventListener("focusin",C),r.removeEventListener("focusout",N))});const V=t=>{s(W,t)},$=t=>s(X,t),C=t=>{const r=T(o);if(!r)return;const c=t.target,a=t.relatedTarget,i=c&&r.contains(c);e.trapped||a&&r.contains(a)||(n=a),i&&s("focusin",t),!E.paused&&e.trapped&&(i?u=c:l(u,!0))},N=t=>{const r=T(o);if(!(E.paused||!r))if(e.trapped){const c=t.relatedTarget;!Ee(c)&&!r.contains(c)&&setTimeout(()=>{if(!E.paused&&e.trapped){const a=L({focusReason:f.value});s("focusout-prevented",a),a.defaultPrevented||l(u,!0)}},0)}else{const c=t.target;c&&r.contains(c)||s("focusout",t)}};async function G(){await j();const t=T(o);if(t){h.push(E);const r=t.contains(document.activeElement)?n:document.activeElement;if(n=r,!t.contains(r)){const a=new Event(P,J);t.addEventListener(P,V),t.dispatchEvent(a),a.defaultPrevented||j(()=>{let i=e.focusStartEl;ae(i)||(l(i),document.activeElement!==i&&(i="first")),i==="first"&&Ce(re(t),!0),(document.activeElement===r||i==="container")&&l(t)})}}}function q(){const t=T(o);if(t){t.removeEventListener(P,V);const r=new CustomEvent(U,{...J,detail:{focusReason:f.value}});t.addEventListener(U,$),t.dispatchEvent(r),!r.defaultPrevented&&(f.value=="keyboard"||!Ne()||t.contains(document.activeElement))&&l(n??document.body),t.removeEventListener(U,$),h.remove(E),n=null,u=null}}return H(()=>{e.trapped&&G(),k(()=>e.trapped,t=>{t?G():q()})}),B(()=>{e.trapped&&q(),o.value&&(o.value.removeEventListener("keydown",v),o.value.removeEventListener("focusin",C),o.value.removeEventListener("focusout",N),o.value=void 0),n=null,u=null}),{onKeydown:v}}});function we(e,s,o,n,u,f){return K(e.$slots,"default",{handleKeydown:e.onKeydown})}var Ve=ne(Fe,[["render",we],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);const ke=pe({to:{type:ve([String,Object]),required:!0},disabled:Boolean}),Ie=te({__name:"teleport",props:ke,setup(e){return(s,o)=>s.disabled?K(s.$slots,"default",{key:0}):(de(),fe(le,{key:1,to:s.to},[K(s.$slots,"default")],8,["to"]))}});var De=ne(Ie,[["__file","/home/runner/work/element-plus/element-plus/packages/components/teleport/src/teleport.vue"]]);const $e=me(De);var Pe=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(Pe||{});const b=e=>{const s=I(e)?e:[e],o=[];return s.forEach(n=>{var u;I(n)?o.push(...b(n)):D(n)&&((u=n.component)!=null&&u.subTree)?o.push(n,...b(n.component.subTree)):D(n)&&I(n.children)?o.push(...b(n.children)):D(n)&&n.shapeFlag===2?o.push(...b(n.type())):o.push(n)}),o};export{Ve as E,Se as F,Pe as P,$e as a,b as f,ke as t};
